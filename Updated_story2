# Let's create a smooth introduction to the user
# time model will create delays between text
# Code assists from https://www.youtube.com/watch?v=FblABqaKz_U and w3schools.com/python/python_functions.asp
# https://www.geeksforgeeks.org --> delay text in python
# https://www.w3schools.com/python/ref_list_clear.asp
import time
# sys model will allow us to exit program if user wants to quit
import sys
# Setup for world building and character guide
# Inventory system needs to be added
guide_name = "AOI"
user_name = ""
inventory = []


# Function to print text with a delay
def delay_text(text, delay=.01):
    # Loop through each character from text and print it after delay
    for char in text:
        # char is character in text, delays the output
        sys.stdout.write(char) 
        # Flush ensures that the output is printed
        sys.stdout.flush()
        # delay the time and print the next character
        time.sleep(delay)
# Be sure that this function is not in the for char in text loop, otherwise it will make the text vertical
    print()  

####################################################################################
# this function is the for loop
def loading_screen():
    for i in range(3):
        delay_text("...", .05)

####################################################################################

def intro():
    # global allows us to use the variable outside of the function. This is important because we want to use the user_name variable in other functions.
    global user_name
    # Clear inventory at the start of each new game
    inventory.clear() 
    delay_text("Welcome user!")
    # old code --> delay_text("..." , .05)
    loading_screen()
    delay_text("Loading program...")
    delay_text("Hello I'm " + guide_name + " guess you are here to start your adventure!")
    delay_text("Before we start, I need to know your name..")
    # The user can input their name and it will be stored in the user_name variable
    user_name = input("->")
    delay_text("Welcome " + user_name + "! \n" + guide_name + ": This will be a path adventure you pick a path and we will see the outcome!")
    inventory.append("Dagger")
    inventory.append("Armor")
    inventory.append("Health Potion")
    offer_inspect_inventory()

##################################################################################
# Checking player inventory function
def inspect_inventory():
    print("\n=============== INVENTORY ===============")
    if len(inventory) == 0:
        delay_text("You have nothing in your inventory.")
    else:
        for item in inventory:
            delay_text(f"- {item}")
    print("=========================================\n")

# Ask player if they want to inspect inventory (after loot/boss fights)
def offer_inspect_inventory():
    while True:
        choice = input("Do you want to check your inventory? Either 'yes' or 'no': ").lower()
        if choice in ['yes', 'y']:
            inspect_inventory()
            return
        elif choice in ['no', 'n']:
            return
        else:
            delay_text("Invalid choice, please enter 'yes' or 'no'.")

##################################################################################

# Creating a function for the dragon boss fight sequence
def boss_fight_startup():
    delay_text("*Sudden shake within the cave..*\n")

    # loop function
    # The boss fight will only run once, but the loop allows for easy expansion in the future
   # add a while loop repeat similar to boss fight
    roar = 3
    while roar > 0:
        delay_text("*ROOOOOOOOOOOAAAAARRRRRR*")
        roar -= 1

    # Now the dragon appears AFTER the 3 roars
    delay_text("\n* A massive dragon emerges from the shadows, its scales glistening in the dim light. It lets out a deafening roar as it prepares to attack! *\n")
    delay_text(guide_name + ": " + user_name + " this doesn't look good!! This is really bad!")

    choice = input(guide_name + ": We have two options, either we fight the dragon or try to run for it!\n 1. fight or 2. run like a coward: ")

    # The user can choose to fight the dragon or run away
    if choice == "1":
        delay_text("*You harden your teeth and grip your sword tightly, readying your shield.*\n")
        delay_text("*You lunge at the dragon, dodging its fiery breath and striking at its weak points. After a fierce battle, you emerge victorious!*\n")
        delay_text(guide_name + ": You actually did it!! Honestly thought you were gonna be dragon food..\n*")
        delay_text(user_name + ": ..... *You stand there speachless looking at the guide*\n")
        delay_text(guide_name + ": Got nothing to say huh? Well I guess actions speak louder than words! \nCongrats on completing the adventure!")
    elif choice == "2":
        delay_text("*You turn and sprint for the exit but the dragon is faster... You have died!*")
    else:
        delay_text("Invalid choice, please choose either 1 or 2.")
        cave_path()
       
##########################################################################################

def bandit_leader_encounter():
    delay_text("*The rats scatter back to their leader*\n")

# add a while loop repeat similar to boss fight
    repeat = 3
    # loop function
    while repeat > 0:
        delay_text("thunderous footsteps approach..\n")
        # decrease repeat by 1
        repeat -= 1

    delay_text("Bandit 1: Boss, we have a problem, there's a stranger at the village..\n")
    delay_text("Bandit 2: Yeah boss, they took out half of our men!\n")
    delay_text("*Bandit leader snarls in anger*\n Leader: You let a nobody defeat y'all? Pathetic! I thought y'all would be tough enough to handle a weakling.")
    delay_text("\n*Bandit leader situps from his throne*\n Leader: I better go take scare of this problem myself since y'all can't handle a simple task.\n")
    delay_text("*The bandit leader storms out of the hideout towards the village*\n")

#########################################################################################

# Creating a function for user path decision making village path or explore deeper in cave path
def village_path():
    delay_text("*You exit out the cave and head towards the distance light, as you get closer you see a village. You enter the village and ask for some help.*\n*They let you sleep in a cabin for the night.*\n")
    delay_text(guide_name + ": Hey wake up " + user_name + " I can hear some noise outside, it sounds like someone is in trouble! Do you want to go check it out?")
    # The user can choose to go check it out or stay in the cabin
    choice = input("Choose either 1 or 2: \n1. yes or 2. no: ")
    if choice == "1":
        delay_text("*You dash outside finding a women being tormented by a group of bandits, you notice a steel sword on the ground, you pick it up and fight off the bandits*\n")
        inventory.append("Worn Down Steel Sword")
        delay_text("*The bandits flee in fear*\n We'll be back! So watch your back!\n")
        offer_inspect_inventory()
        bandit_leader_encounter()

    elif choice == "2":
        delay_text("*You hear the cries for help getting louder and louder, then suddenly stop. A sharp axe prices through the door than a bandit enters seeing you hiding in the corner, he swings his axe at you and you are killed instantly. Better luck next time!")
        delay_text(guide_name + ": I guess you weren't ready to be a hero yet, maybe next time you will be more brave and courageous!")
        delay_text("\nAchievment Unlocked: Cowardly Adventurer")
    else:
        delay_text("Invalid choice, please choose either 1 or 2.")
        village_path()

#######################################################################################

# cave path root
def cave_path():
    delay_text(guide_name + ": Ahh I appears you want to see what is within this cave, well be careful, it could be dangerous. \n*You travel deeper into the cave and see a chest in the distance, you walk towards it and open it*\n*Inside you find a sword and a shield, you take them and continue to explore the cave*\n")
    # add item to inventory
    inventory.append("Sword")
    inventory.append("Shield")
    delay_text("\n*Sheild and Sword have been added to your inventory*\n")
    offer_inspect_inventory()
    delay_text(guide_name + ": Oh wow it looks like you found some useful items, though I wonder if you can even use them with your weak arms.. I mean I think you got this!!!\n")
    delay_text("*You ingore your guide though you are disappoint of it's remarks, you continue but, soon find yourself in a empty room, suddenly the door behind you slams shut!*\n")
    delay_text(guide_name + ": HMMM it appears that we are stuck in he- *before the guide can finish it's sentence, a slim monster appears in front of you*")
    delay_text(guide_name + ": Hey " + user_name + " it looks like we have a choice. Either we FIGHT the monster or DO NOTHING and hope it doesn't attack us.")
    # The user can choose to fight the monster or do nothing
    choice = input("\nWhat do you choose? (1.fight or 2.nothing)")
    if choice == "1":
        delay_text("*You decide to fight the monster, you lift up your sword and shield and prepare for battle. \nThe monster lunges at you but you block it with your shield, you strike back with your sword and defeat the monster!*\n")
        delay_text(guide_name + ": Wow " + user_name + " now you can say that armor isn't for show. Looks like it dropped a key, maybe it'll open that door.")
        delay_text("*You pick up the key and open the door, you find a treasure chest inside, you open it and find a lot of gold and jewels!*\n")
        delay_text(guide_name + ": " + user_name + " it looks like you found some neat treasure but, something feels off..")
        boss_fight_startup()

    elif choice == "2":
        delay_text(guide_name + ": Umm " + user_name + " it CAN SEE YOU!! *The slim monster jumps at you turning you to a puddle of goo, you have died!* Better luck next time!")
    else:
        delay_text("Invalid choice, please choose either 1 or 2.")
        cave_path()

#################################################################################


def story():

    delay_text(guide_name + ": Now that we got the introduction out the way, you have two paths to choose from. "
    "\nPath 1: You see a light in the distance, it looks like a village. You can head towards it and see if you can find help.\n"
    "Path 2: You see a dark cave, it looks like it could be dangerous but there might be something valuable inside. You can head towards it and see if you can find anything useful.\n")

    choice = input("Which path do you choose? (1, 2, or inventory) ").lower()

    # ðŸ”¹ Inventory command added
    if choice == "inventory":
        delay_text("\n=============== Inventory ===============")
        if len(inventory) == 0:
            delay_text("Your inventory is empty.")
        else:
            for item in inventory:
                delay_text(f"- {item}")
        delay_text("========================================\n")
        story()  # return to path choice

    # Path choice to go to the village
    elif choice == "1":
        village_path()
    # Path choice to go to the cave
    elif choice == "2":
        cave_path()
    # In case the user want to not follow the path options
    else:
        delay_text("Invalid choice, please choose either 1 or 2.")
        story()


# restart while loop function to restart the story
# This means at any point after the story ends, the user can choose to restart the adventure
while True: 
    intro()
    story()
    # Ask if the user if they want to play again after first playthrough
    play_again = input("Do you want to restart the adventure? (Yes/No) ").lower()
    if play_again != "yes":
        delay_text("See you soon " + user_name + "!")
        break
